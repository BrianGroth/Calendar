<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendar · Settings</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <h1>Settings</h1>
    <nav><a class="btn" href="index.html">Back to Calendar</a></nav>
  </header>

  <main class="settings">
    <form id="settingsForm" autocomplete="off">
      <fieldset>
        <legend>GitHub</legend>
        <label>Repo owner
          <input id="owner" required placeholder="YourGitHubUser" />
        </label>
        <label>Repo name
          <input id="repo" required placeholder="Calendar" />
        </label>
        <label>Personal Access Token (PAT)
          <input id="token" type="password" placeholder="••••••••" />
        </label>
      </fieldset>

      <fieldset>
        <legend>Calendar preferences</legend>
        <label>Week starts on
          <select id="weekStart">
            <option value="1" selected>Monday</option>
            <option value="0">Sunday</option>
          </select>
        </label>
        <label>Time format
          <select id="timeFormat">
            <option value="24" selected>24-hour</option>
            <option value="12">12-hour</option>
          </select>
        </label>
        <label>Timezone (IANA)
          <input id="timeZone" value="Europe/Amsterdam" />
        </label>
        <label>Theme
          <select id="theme">
            <option value="light" selected>Light</option>
            <option value="auto">Auto</option>
          </select>
        </label>
      </fieldset>

      <fieldset>
        <legend>TripIt</legend>
        <label>TripIt iCal URL (private)
          <input id="tripitUrl" type="url" placeholder="https://www.tripit.com/feed/ical/private/....ics" />
        </label>
      </fieldset>

      <fieldset>
        <legend>Holiday iCal URLs</legend>
        <label>US holidays iCal URL
          <input id="holUS" type="url" placeholder="https://...us.ics" />
        </label>
        <label>UK holidays iCal URL
          <input id="holUK" type="url" placeholder="https://...uk.ics" />
        </label>
        <label>NL holidays iCal URL
          <input id="holNL" type="url" placeholder="https://...nl.ics" />
        </label>
      </fieldset>

      <menu>
        <button type="button" id="clear">Clear local settings</button>
        <button class="btn" type="submit">Save</button>
      </menu>
    </form>

    <p class="help">
      Notes: Your PAT and iCal URLs are stored only in your browser’s localStorage and are never committed to the repo.
      If a token leaks, revoke it in GitHub → Settings → Developer settings → Personal access tokens.
    </p>
  </main>

  <script type="module">
    import { getSettings, setSettings, clearSettings } from './lib/github.js';

    const form = document.getElementById('settingsForm');
    const s = getSettings();

    form.owner.value = s.owner || '';
    form.repo.value = s.repo || 'Calendar';
    form.token.value = s.token || '';
    form.weekStart.value = String(s.weekStart ?? 1);
    form.timeFormat.value = String(s.timeFormat ?? 24);
    form.timeZone.value = s.timeZone || 'Europe/Amsterdam';
    form.theme.value = s.theme || 'light';
    form.tripitUrl.value = s.tripitUrl || '';
    form.holUS.value = s.holidays?.us || '';
    form.holUK.value = s.holidays?.uk || '';
    form.holNL.value = s.holidays?.nl || '';

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      setSettings({
        owner: form.owner.value.trim(),
        repo: form.repo.value.trim(),
        token: form.token.value.trim(),
        weekStart: Number(form.weekStart.value),
        timeFormat: Number(form.timeFormat.value),
        timeZone: form.timeZone.value.trim(),
        theme: form.theme.value,
        tripitUrl: form.tripitUrl.value.trim(),
        holidays: {
          us: form.holUS.value.trim(),
          uk: form.holUK.value.trim(),
          nl: form.holNL.value.trim(),
        },
      });
      alert('Settings saved locally.');
    });

    document.getElementById('clear').addEventListener('click', () => {
      if (confirm('Clear all locally saved settings?')) {
        clearSettings();
        location.reload();
      }
    });
  </script>
</body>
</html>
