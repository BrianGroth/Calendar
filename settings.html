<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendar Settings</title>
  <!-- Reuse main styles for typography and buttons -->
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Additional styles specific to settings page */
    .settings-container {
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
      background-color: #fff;
      border: 1px solid #eee;
      border-radius: 4px;
    }
    .settings-container h1 {
      margin-top: 0;
      font-size: 1.5rem;
    }
    .settings-container form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .settings-container label {
      display: flex;
      flex-direction: column;
      font-size: 0.875rem;
    }
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    .note {
      font-size: 0.75rem;
      color: #666;
    }
    input[type="password"] {
      font-family: monospace;
    }
  </style>
</head>
<body>
  <main class="settings-container">
    <h1>Settings</h1>
    <form id="settingsForm">
      <label>
        GitHub Owner
        <input type="text" id="owner" name="owner" placeholder="e.g. BrianGroth" required>
      </label>
      <label>
        Repository Name
        <input type="text" id="repo" name="repo" placeholder="e.g. Calendar" required>
      </label>
      <label>
        Personal Access Token
        <input type="password" id="token" name="token" placeholder="ghp_..." autocomplete="new-password">
        <span class="note">Stored locally only; never sent to the server except when saving events.</span>
      </label>
      <label>
        TripIt iCal URL
        <input type="url" id="tripitIcalUrl" name="tripitIcalUrl" placeholder="https://...">
        <span class="note">Leave blank if you don't want TripIt overlay.</span>
      </label>
      <fieldset>
        <legend>Holiday iCal URLs</legend>
        <label>
          US Holidays
          <input type="url" id="holidaysUsUrl" name="holidays.usUrl" placeholder="https://...">
        </label>
        <label>
          UK Holidays
          <input type="url" id="holidaysUkUrl" name="holidays.ukUrl" placeholder="https://...">
        </label>
        <label>
          Netherlands Holidays
          <input type="url" id="holidaysNlUrl" name="holidays.nlUrl" placeholder="https://...">
        </label>
      </fieldset>
      <label>
        Timezone
        <input type="text" id="timezone" name="timezone" placeholder="e.g. Europe/Amsterdam">
      </label>
      <label>
        Week starts on
        <select id="weekStart" name="weekStart">
          <option value="1">Monday</option>
          <option value="0">Sunday</option>
        </select>
      </label>
      <label>
        Time format
        <select id="timeFormat" name="timeFormat">
          <option value="24h">24‑hour</option>
          <option value="12h">12‑hour</option>
        </select>
      </label>
      <label>
        Theme
        <select id="theme" name="theme">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </label>
      <div class="form-actions">
        <button type="submit">Save</button>
        <button type="button" id="cancelSettings">Cancel</button>
      </div>
    </form>
  </main>
  <script>
    // Load settings from localStorage and populate the form
    function loadSettings() {
      const raw = localStorage.getItem('calendarSettings');
      let settings = {};
      if (raw) {
        try { settings = JSON.parse(raw); } catch (e) {}
      }
      document.getElementById('owner').value = settings.owner || '';
      document.getElementById('repo').value = settings.repo || '';
      document.getElementById('token').value = settings.token || '';
      document.getElementById('tripitIcalUrl').value = settings.tripitIcalUrl || '';
      const holidays = settings.holidays || {};
      document.getElementById('holidaysUsUrl').value = holidays.usUrl || '';
      document.getElementById('holidaysUkUrl').value = holidays.ukUrl || '';
      document.getElementById('holidaysNlUrl').value = holidays.nlUrl || '';
      document.getElementById('timezone').value = settings.timezone || 'Europe/Amsterdam';
      document.getElementById('weekStart').value = settings.weekStart != null ? settings.weekStart : 1;
      document.getElementById('timeFormat').value = settings.timeFormat || '24h';
      document.getElementById('theme').value = settings.theme || 'light';
    }
    // Save settings back to localStorage
    function saveSettings() {
      const settings = {
        owner: document.getElementById('owner').value.trim(),
        repo: document.getElementById('repo').value.trim(),
        token: document.getElementById('token').value.trim(),
        tripitIcalUrl: document.getElementById('tripitIcalUrl').value.trim(),
        holidays: {
          usUrl: document.getElementById('holidaysUsUrl').value.trim(),
          ukUrl: document.getElementById('holidaysUkUrl').value.trim(),
          nlUrl: document.getElementById('holidaysNlUrl').value.trim()
        },
        timezone: document.getElementById('timezone').value.trim() || 'Europe/Amsterdam',
        weekStart: parseInt(document.getElementById('weekStart').value, 10),
        timeFormat: document.getElementById('timeFormat').value,
        theme: document.getElementById('theme').value
      };
      localStorage.setItem('calendarSettings', JSON.stringify(settings));
    }
    document.getElementById('settingsForm').addEventListener('submit', function(event) {
      event.preventDefault();
      saveSettings();
      // Redirect back to calendar
      window.location.href = 'index.html';
    });
    document.getElementById('cancelSettings').addEventListener('click', function() {
      window.location.href = 'index.html';
    });
    loadSettings();
  </script>
</body>
</html>