<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings • Calendar</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="topbar">
    <h1>Settings</h1>
    <nav>
      <a href="index.html"><button type="button">← Back to Calendar</button></a>
    </nav>
  </header>

  <main class="settings">
    <section class="card">
      <h2>Calendars & Integrations</h2>
      <div class="grid">
        <div class="row">
          <label>
            US Holidays iCal URL
            <input id="hol_us" type="url" placeholder="https://...us-holidays.ics" />
          </label>
          <label>
            UK Holidays iCal URL
            <input id="hol_uk" type="url" placeholder="https://...uk-holidays.ics" />
          </label>
        </div>
        <label>
          NL Holidays iCal URL
          <input id="hol_nl" type="url" placeholder="https://...nl-holidays.ics" />
        </label>
      </div>
    </section>

    <section class="card" style="margin-top:1rem;">
      <h2>Preferences</h2>
      <div class="grid">
        <label>
          Theme
          <select id="theme">
            <option value="light">Light</option>
          </select>
        </label>
        <label>
          Week starts on
          <select id="weekStart">
            <option value="1">Monday</option>
          </select>
        </label>
        <label>
          Time format
          <select id="timeFormat">
            <option value="24">24-hour</option>
          </select>
        </label>
        <label>
          Timezone
          <select id="timezone">
            <option value="Europe/Amsterdam">Europe/Amsterdam</option>
          </select>
        </label>
      </div>
      <div class="actions">
        <button id="saveBtn" type="button">Save Settings</button>
        <button id="clearBtn" type="button">Clear Local Settings</button>
      </div>
      <p class="hint">Settings are saved to your browser's local storage.</p>
    </section>
  </main>

  <div id="status" aria-live="polite" class="status"></div>

  <script>
    (function () {
      const KEY = 'calendar.settings.v1';
      const defaults = {
        timeFormat24h: true, weekStart: 1, timezone: 'Europe/Amsterdam', theme: 'light',
        holidays: { usUrl: '', ukUrl: '', nlUrl: '' }
      };

      function loadLocal() { try { const j = localStorage.getItem(KEY); return j ? JSON.parse(j) : { ...defaults }; } catch { return { ...defaults }; } }
      function saveLocal(s) { localStorage.setItem(KEY, JSON.stringify(s)); }
      function status(msg) { const el = document.getElementById('status'); if (el) el.textContent = msg; }

      const s = loadLocal();
      const $ = (id) => document.getElementById(id);

      $('#hol_us').value = (s.holidays && s.holidays.usUrl) || '';
      $('#hol_uk').value = (s.holidays && s.holidays.ukUrl) || '';
      $('#hol_nl').value = (s.holidays && s.holidays.nlUrl) || '';
      $('#theme').value = s.theme || 'light';
      $('#weekStart').value = String(s.weekStart ?? 1);
      $('#timeFormat').value = s.timeFormat24h ? '24' : '12';
      $('#timezone').value = s.timezone || 'Europe/Amsterdam';

      // Local save
      $('#saveBtn').addEventListener('click', () => {
        const next = {
          timeFormat24h: $('#timeFormat').value === '24',
          weekStart: Number($('#weekStart').value || 1),
          timezone: $('#timezone').value,
          theme: $('#theme').value,
          holidays: {
            usUrl: $('#hol_us').value.trim(),
            ukUrl: $('#hol_uk').value.trim(),
            nlUrl: $('#hol_nl').value.trim()
          }
        };
        saveLocal(next);
        status('Settings saved locally.');
      });

      // Clear local
      $('#clearBtn').addEventListener('click', () => {
        localStorage.removeItem(KEY);
        status('Local settings cleared. Page will now reload.');
        setTimeout(() => window.location.reload(), 600);
      });
    })();
  </script>
</body>

</html>